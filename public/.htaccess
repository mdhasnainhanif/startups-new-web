# ---------------------------
# SPA routing (safe)
# ---------------------------
RewriteEngine On

# Do NOT rewrite real files/folders
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA fallback
RewriteRule ^ index.html [L]


# ---------------------------
# Compression (Brotli first, then Gzip)
# ---------------------------
<IfModule mod_brotli.c>
  AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css
  AddOutputFilterByType BROTLI_COMPRESS text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
  AddOutputFilterByType DEFLATE text/javascript application/javascript application/json application/xml image/svg+xml
  Header append Vary Accept-Encoding
</IfModule>

# Don't compress already-compressed formats
<IfModule mod_deflate.c>
  SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|webp|avif|ico|mp4|mov|zip|gz|br|woff2?)$ no-gzip dont-vary
</IfModule>


# ---------------------------
# Cache headers (best practice for Vite/hashed assets)
# ---------------------------
<IfModule mod_headers.c>

  # HTML: don't cache aggressively (SPA index.html must update)
  <FilesMatch "^(index\.html)$">
    Header set Cache-Control "no-cache, must-revalidate"
  </FilesMatch>

  # Hashed assets (recommended): cache long
  <FilesMatch "\.(?:css|js|woff2?|ttf|otf|eot|svg|jpg|jpeg|png|webp|avif|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
